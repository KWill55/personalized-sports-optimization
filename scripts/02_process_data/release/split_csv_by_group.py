"""
Title: split_csv_by_group.py 

Purpose:
    Splits a kinematic summary CSV file (release_summary.csv) into separate CSV files based on joint groups
    (core, arms, legs). This helps with modular analysis and cleaner data management.

Prerequisites:
    - A CSV file generated by process_mot_to_csv.py (release_summary.csv) located in the specified input path

Output:
    - CSV files for each joint group (core_angles.csv, arms_angles.csv, legs_angles.csv)

Usage:
    Run this script after generating the release_summary.csv file.
"""

import pandas as pd
from pathlib import Path

# ======================================== 
# Parameters 
# ========================================

session = "freethrows1"  # Change this to switch sessions

# ======================================== 
# Paths 
# ========================================

script_dir = Path(__file__).resolve().parent
base_dir = script_dir.parents[2]  # Go up to project root
session_dir = base_dir / "data" / session
release_dir = session_dir / "release"

release_summary_path = release_dir / "release_summary.csv"
core_path = release_dir / "core_angles.csv"
arms_path = release_dir / "arms_angles.csv"
legs_path = release_dir / "legs_angles.csv"

# Ensure output folder exists
release_dir.mkdir(parents=True, exist_ok=True)


# ======================================== 
# Read release summary CSV
# ========================================

# Load the release summary
df = pd.read_csv(release_summary_path)

# ======================================== 
# Define Joint Groups
# ========================================

# Define groups
pelvis = ['pelvis_tilt', 'pelvis_list', 'pelvis_rotation']
hips_r = ['hip_flexion_r', 'hip_adduction_r', 'hip_rotation_r']
hips_l = ['hip_flexion_l', 'hip_adduction_l', 'hip_rotation_l']
lumbar = ['lumbar_extension', 'lumbar_bending', 'lumbar_rotation']
core_cols = pelvis + hips_r + hips_l + lumbar

arms_r = ['arm_flex_r', 'arm_add_r', 'arm_rot_r', 'elbow_flex_r', 'pro_sup_r']
arms_l = ['arm_flex_l', 'arm_add_l', 'arm_rot_l', 'elbow_flex_l', 'pro_sup_l']
arms_cols = arms_r + arms_l

legs_r = ['knee_angle_r', 'ankle_angle_r', 'subtalar_angle_r', 'mtp_angle_r']
legs_l = ['knee_angle_l', 'ankle_angle_l', 'subtalar_angle_l', 'mtp_angle_l']
legs_cols = legs_r + legs_l

# Always include identifying columns
id_cols = ['file', 'clip_name', 'outcome']

# ======================================== 
# Save Split CSVs
# ========================================

if all(col in df.columns for col in core_cols):
    df[id_cols + core_cols].to_csv(core_path, index=False)

if all(col in df.columns for col in arms_cols):
    df[id_cols + arms_cols].to_csv(arms_path, index=False)

if all(col in df.columns for col in legs_cols):
    df[id_cols + legs_cols].to_csv(legs_path, index=False)

print("CSV files split into: core_angles.csv, arms_angles.csv, legs_angles.csv")
